(window.webpackJsonp=window.webpackJsonp||[]).push([[333],{698:function(e,a,n){"use strict";n.r(a);var s=n(25),t=Object(s.a)({},(function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"miscellaneous-node-helpers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#miscellaneous-node-helpers"}},[e._v("#")]),e._v(" Miscellaneous Node Helpers")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#api_nan_asyncresource"}},[n("b",[n("code",[e._v("Nan::AsyncResource")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#api_nan_make_callback"}},[n("b",[n("code",[e._v("Nan::MakeCallback()")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#api_nan_module_init"}},[n("b",[n("code",[e._v("NAN_MODULE_INIT()")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#api_nan_export"}},[n("b",[n("code",[e._v("Nan::Export()")])])])])]),e._v(" "),n("p",[n("a",{attrs:{name:"api_nan_asyncresource"}})]),e._v(" "),n("h3",{attrs:{id:"nan-asyncresource"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nan-asyncresource"}},[e._v("#")]),e._v(" Nan::AsyncResource")]),e._v(" "),n("p",[e._v("This class is analogous to the "),n("code",[e._v("AsyncResource")]),e._v(" JavaScript class exposed by Node's "),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("async_hooks"),n("OutboundLink")],1),e._v(" API.")]),e._v(" "),n("p",[e._v("When calling back into JavaScript asynchronously, special care must be taken to ensure that the runtime can properly track\nasync hops. "),n("code",[e._v("Nan::AsyncResource")]),e._v(" is a class that provides an RAII wrapper around "),n("code",[e._v("node::EmitAsyncInit")]),e._v(", "),n("code",[e._v("node::EmitAsyncDestroy")]),e._v(",\nand "),n("code",[e._v("node::MakeCallback")]),e._v(". Using this mechanism to call back into JavaScript, as opposed to "),n("code",[e._v("Nan::MakeCallback")]),e._v(" or\n"),n("code",[e._v("v8::Function::Call")]),e._v(" ensures that the callback is executed in the correct async context. This ensures that async mechanisms\nsuch as domains and "),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("async_hooks"),n("OutboundLink")],1),e._v(" function correctly.")]),e._v(" "),n("p",[e._v("Definition:")]),e._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("class AsyncResource {\n public:\n  AsyncResource(v8::Local<v8::String> name,\n                v8::Local<v8::Object> resource = New<v8::Object>());\n  AsyncResource(const char* name,\n                v8::Local<v8::Object> resource = New<v8::Object>());\n  ~AsyncResource();\n\n  v8::MaybeLocal<v8::Value> runInAsyncScope(v8::Local<v8::Object> target,\n                                            v8::Local<v8::Function> func,\n                                            int argc,\n                                            v8::Local<v8::Value>* argv);\n  v8::MaybeLocal<v8::Value> runInAsyncScope(v8::Local<v8::Object> target,\n                                            v8::Local<v8::String> symbol,\n                                            int argc,\n                                            v8::Local<v8::Value>* argv);\n  v8::MaybeLocal<v8::Value> runInAsyncScope(v8::Local<v8::Object> target,\n                                            const char* method,\n                                            int argc,\n                                            v8::Local<v8::Value>* argv);\n};\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br")])]),n("ul",[n("li",[n("code",[e._v("name")]),e._v(": Identifier for the kind of resource that is being provided for diagnostics information exposed by the "),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("async_hooks"),n("OutboundLink")],1),e._v("\nAPI. This will be passed to the possible "),n("code",[e._v("init")]),e._v(" hook as the "),n("code",[e._v("type")]),e._v(". To avoid name collisions with other modules we recommend\nthat the name include the name of the owning module as a prefix. For example "),n("code",[e._v("mysql")]),e._v(" module could use something like\n"),n("code",[e._v("mysql:batch-db-query-resource")]),e._v(".")]),e._v(" "),n("li",[n("code",[e._v("resource")]),e._v(": An optional object associated with the async work that will be passed to the possible "),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("async_hooks"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("init")]),e._v(" hook. If this parameter is omitted, or an empty handle is provided, this object will be created automatically.")]),e._v(" "),n("li",[e._v("When calling JS on behalf of this resource, one can use "),n("code",[e._v("runInAsyncScope")]),e._v(". This will ensure that the callback runs in the\ncorrect async execution context.")]),e._v(" "),n("li",[n("code",[e._v("AsyncDestroy")]),e._v(" is automatically called when an AsyncResource object is destroyed.")])]),e._v(" "),n("p",[e._v("For more details, see the Node "),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("async_hooks"),n("OutboundLink")],1),e._v(" documentation. You might also want to take a look at the documentation for the\n"),n("a",{attrs:{href:"https://nodejs.org/dist/latest-v9.x/docs/api/n-api.html#n_api_custom_asynchronous_operations",target:"_blank",rel:"noopener noreferrer"}},[e._v("N-API counterpart"),n("OutboundLink")],1),e._v(". For example usage, see the "),n("code",[e._v("asyncresource.cpp")]),e._v(" example in the "),n("code",[e._v("test/cpp")]),e._v(" directory.")]),e._v(" "),n("p",[n("a",{attrs:{name:"api_nan_make_callback"}})]),e._v(" "),n("h3",{attrs:{id:"nan-makecallback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nan-makecallback"}},[e._v("#")]),e._v(" Nan::MakeCallback()")]),e._v(" "),n("p",[e._v("Deprecated wrappers around the legacy "),n("code",[e._v("node::MakeCallback()")]),e._v(" APIs. Node.js 10+\nhas deprecated these legacy APIs as they do not provide a mechanism to preserve\nasync context.")]),e._v(" "),n("p",[e._v("We recommend that you use the "),n("code",[e._v("AsyncResource")]),e._v(" class and "),n("code",[e._v("AsyncResource::runInAsyncScope")]),e._v(" instead of using "),n("code",[e._v("Nan::MakeCallback")]),e._v(" or\n"),n("code",[e._v("v8::Function#Call()")]),e._v(" directly. "),n("code",[e._v("AsyncResource")]),e._v(" properly takes care of running the callback in the correct async execution\ncontext – something that is essential for functionality like domains, async_hooks and async debugging.")]),e._v(" "),n("p",[e._v("Signatures:")]),e._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("NAN_DEPRECATED\nv8::Local<v8::Value> Nan::MakeCallback(v8::Local<v8::Object> target,\n                                       v8::Local<v8::Function> func,\n                                       int argc,\n                                       v8::Local<v8::Value>* argv);\nNAN_DEPRECATED\nv8::Local<v8::Value> Nan::MakeCallback(v8::Local<v8::Object> target,\n                                       v8::Local<v8::String> symbol,\n                                       int argc,\n                                       v8::Local<v8::Value>* argv);\nNAN_DEPRECATED\nv8::Local<v8::Value> Nan::MakeCallback(v8::Local<v8::Object> target,\n                                       const char* method,\n                                       int argc,\n                                       v8::Local<v8::Value>* argv);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("p",[n("a",{attrs:{name:"api_nan_module_init"}})]),e._v(" "),n("h3",{attrs:{id:"nan-module-init"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nan-module-init"}},[e._v("#")]),e._v(" NAN_MODULE_INIT()")]),e._v(" "),n("p",[e._v("Used to define the entry point function to a Node add-on. Creates a function with a given "),n("code",[e._v("name")]),e._v(" that receives a "),n("code",[e._v("target")]),e._v(" object representing the equivalent of the JavaScript "),n("code",[e._v("exports")]),e._v(" object.")]),e._v(" "),n("p",[e._v("See example below.")]),e._v(" "),n("p",[n("a",{attrs:{name:"api_nan_export"}})]),e._v(" "),n("h3",{attrs:{id:"nan-export"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nan-export"}},[e._v("#")]),e._v(" Nan::Export()")]),e._v(" "),n("p",[e._v("A simple helper to register a "),n("code",[e._v("v8::FunctionTemplate")]),e._v(" from a JavaScript-accessible method (see "),n("RouterLink",{attrs:{to:"/Study/工程化/gulp 学习代码/gulp-project/node_modules/nan/doc/methods.html"}},[e._v("Methods")]),e._v(") as a property on an object. Can be used in a way similar to assigning properties to "),n("code",[e._v("module.exports")]),e._v(" in JavaScript.")],1),e._v(" "),n("p",[e._v("Signature:")]),e._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("void Export(v8::Local<v8::Object> target, const char *name, Nan::FunctionCallback f)\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("Also available as the shortcut "),n("code",[e._v("NAN_EXPORT")]),e._v(" macro.")]),e._v(" "),n("p",[e._v("Example:")]),e._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("NAN_METHOD(Foo) {\n  ...\n}\n\nNAN_MODULE_INIT(Init) {\n  NAN_EXPORT(target, Foo);\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);